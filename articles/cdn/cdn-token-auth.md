<properties
	pageTitle="Securing Azure CDN assets with token authentication | Microsoft Azure"
	description="Using token authentication to secure access to your Azure CDN assets."
	services="cdn"
	documentationCenter=""
	authors="zhangmanling"
	manager="zhangmanling"
	editor=""/>

<tags
	ms.service="cdn"
	ms.workload="tbd"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="11/8/2016"
	ms.author="mazha"/>

# Securing Azure CDN assets with token authentication

[AZURE.INCLUDE [cdn-premium-feature](../../includes/cdn-premium-feature.md)]

##Overview

Token authentication is a mechanism that allows you to prevent Azure CDN from serving assets to unauthorized clients.  This is typically done to prevent "hotlinking" of content, where a different website, often a message board, uses your assets without permission.  This can have an impact on your content delivery costs. By enabling this feature on CDN, requests will be authenticated by CDN edge POPs before delivering the content. 


## How it works

Token authentication verifies requests are generated by a trusted site by requiring requests to contain a token value containing encoded information about the requester. Content will only be served to requester when the encoded information meet the requirements, otherwise requests will be denied. You can set up the requirement using one or multiple parameters below:

- Country: allow or deny requests that originated from specified countries. [List of valid country codes.](https://msdn.microsoft.com/library/mt761717.aspx) 
- URL: only allow specified asset or path to request.  
- Host: allow or deny requests using specified hosts in the request header.
- Referrer: allow or deny specified referrer to request.
- IP address: only allow requests that originated from specific IP address or IP subnet.
- Protocol: allow or block requests based on the protocol used to request the content.
- Expiration time: assign a date and time period to ensure that a link only remains valid for a limited time period.

## Reference architecture

See below a reference architecture of setting up token authentication on CDN to work with your Web App.
	![CDN profile blade manage button](./media/cdn-token-auth/cdn-token-auth-workflow2.png)

## Token validation logic on CDN endpoint
	
This chart describes how Azure CDN validates client request when token authentication is configured on CDN endpoint.
	![CDN profile blade manage button](./media/cdn-token-auth/cdn-token-auth-validation-logic.png)

## Setting up token authentication

1. From the [Azure portal](https://portal.azure.com), browse to your CDN profile, and then click the **Manage** button to launch the supplemental portal.

	![CDN profile blade manage button](./media/cdn-rules-engine/cdn-manage-btn.png)

2. Hover over **HTTP Large**, and then click **Token Auth** in the flyout. You will set up encryption key and encryption parameters in this tab.

	1) Enter a unique encryption key for **Primary Key**.  Enter another for **Backup Key**

	![CDN token auth setup key](./media/cdn-token-auth/cdn-token-auth-setupkey.png)
	
	2) Set up encryption parameters with encryption tool (allow or deny requests based on expiration time, country, referrer, protocol, client IP. You can use any combination.

	![CDN profile blade manage button](./media/cdn-token-auth/cdn-token-auth-encrypttool.png)

	3) You can test your token with the decription tool

	4) You can also customize the type of response that will be returned to user when request is denied. By default we use 403.

3. Now click **Rules Engine** tab under **HTTP Large**. You will use this tab to define paths to apply the feature, enable the token auth feature, and enable additional token auth related capabilities.

	1) Use "IF" column to define asset or path that you want to apply token auth. 

	2) Click to add "Token Auth" from the feature dropdown to enable token auth.
	
	![CDN profile blade manage button](./media/cdn-token-auth/cdn-rules-engine-enable2.png)

4. In the **Rules Engine** tab, there are a few additional capabilities you can enable.
	
	1) Token auth denial code: determines the type of response that will be returned to user when a request is denied.
	
	2) Token auth ignore: determines whether URL used to validate token will be case sensitive.

	3) Token auth parameter: rename the token auth query string parameter showing in the requested URL. 
		
	![CDN profile blade manage button](./media/cdn-token-auth/cdn-rules-engine2.png)

5. You can customize your token which is an application that generates token for Token-based authentication features. Source code can be accessed here in [Github](https://github.com/VerizonDigital/ectoken).
Available languages include:
	1. C
	2. C#
	3. PHP
	4. Perl
	5. Java
	6. Python	


