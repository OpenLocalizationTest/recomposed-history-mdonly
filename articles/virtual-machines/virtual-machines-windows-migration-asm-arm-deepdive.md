<properties
	pageTitle="Technical Deep Dive on Platform supported migration from Classic to Azure Resource Manager"
	description="This article does a technical deep dive on platform supported migration service capabilities Service Management to Azure Resource Manager"
	services="virtual-machines-windows"
	documentationCenter=""
	authors="mahthi"
	manager="drewm"
	editor=""
	tags="azure-resource-manager"/>

<tags
	ms.service="virtual-machines-windows"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-windows"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/04/2016"
	ms.author="mahthi"/>

# Technical Deep Dive on Platform supported migration from Classic to Azure Resource Manager

In this article, we do a technical deep dive on migration at a resource and feature level to help you understand how the platform migrates the resources from Classic to Resource Manager. Please read through the service announcement article - [Platform supported migration of IaaS resources from Classic to Azure Resource Manager stack](virtual-machines-windows-migration-asm-arm).

## Detailed guidance on resource and feature level migration

You can find the classic and resource manager representation of the resources below. Features and resources not listed in this table is not supported at this time.

| Classic Representation                                 | Resource Manager Representation                 | Detailed notes                                                                                                                                                                                                                                                                                                                                                                                                                                                    |   |   |
|--------------------------------------------------------|-------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---|---|
| Cloud Service Name                                     | DNS Name                                        | During migration, we will create a new resource group for every cloud service with the naming pattern - `<cloudservicename>-migrated` which will contain all the resources.Cloud Service Name becomes a DNS Name that is associated with the Public IP Address                                                                                                                                                                                                    |   |   |
| Virtual Machine                                        | Virtual Machine                                 | VM specific properties will be migrated over as is. Please note that certain osProfile information like computer name was not stored in classic stack and hence will remain empty after migration.                                                                                                                                                                                                                                                                |   |   |
| Disk resources attached to VM                          | Implicit disks attached to VM                   | Disks are not modeled as top level resources in the resource manager stack. They will be migrated over as implicit disks under the VM. At this time, we only support disks attached to a VM. Migrating unassociated disks will be supported soon.  To enable migration, classic storage accounts now have the ability to be used by resource manager VMs. So this allows the disks to be easily migrated over to the resource manager model with out any updates. |   |   |
| VM Extensions                                          | VM Extensions                                   | All the resource extensions except XML extensions will be migrated from the classic stack.                                                                                                                                                                                                                                                                                                                                                                        |   |   |
| Virtual Machine Certificates                           | Certificates in Azure Key Vault                 | If a cloud service contains service certificates, platform will create a new azure keyvault per cloud service and move the certificates into the keyvault. The VMs will be updated to reference the certificates from the keyvault.                                                                                                                                                                                                                               |   |   |
| WinRM configuration                                    | WinRM Configuration under osProfile             | WinRM configuration will be moved over as-is as part of the migration.                                                                                                                                                                                                                                                                                                                                                                                            |   |   |
| Availability Set Property                              | Availability Set Resource                       | Availability Set specification was a property on the VM in the classic stack. Availability Sets will become a top level resource as part of the migration. Please note that we don't support the following configuration - 'multiple availability sets per cloud service' or '1 or more availability sets along with VMs that are not in any availability set in a cloud service'.                                                                                |   |   |
| Network Configuration on a VM                          | Primary Network Interface                       | Network Configuration on a VM will now be represented as the primary network interface resource after migration. For VMs that are not in a VNET, the internal IP address will change during migration.                                                                                                                                                                                                                                                            |   |   |
| Multiple Network interfaces on a VM                    | Network Interfaces                              | If a VM had multiple network interfaces associated, then each network interface will become a top level resource as part of the migration in the resource manager stack along with all the properties.                                                                                                                                                                                                                                                            |   |   |
| Load Balanced Endpoint Set                             | Load Balancer                                   | In classic stack, the platform assigned an implicit load balancer for every Cloud Service. During migration, we will create a new load balancer resource and the load balancing endpoint set will become load balancer rules.                                                                                                                                                                                                                                     |   |   |
| Inbound NAT Rules                                      | Inbound NAT Rules                               | Input Endpoints defined on the VM will get converted to Inbound NAT Rules under the load balancer during the migration.                                                                                                                                                                                                                                                                                                                                           |   |   |
| VIP or Virtual IP Address                              | Public IP Address with DNS Name                 | Virtual IP Address or VIP will now become a Public IP Address and will be associated to the load balancer.                                                                                                                                                                                                                                                                                                                                                        |   |   |
| Virtual Network                                        | Virtual Network                                 | Virtual Network will be migrated over with all its properties to the resource manager stack. A new resource group will be created with the name `-migrated`. Please refer to the unsupported configurations [here](./virtual-machines-windows-migration-asm-arm)                                                                                                                                                                                                  |   |   |
| Reserved IPs                                           | Public IP Address with Static allocationMethod  | Reserved IP associated with the load balancer are migrated over along with the migration of the cloud service or the virtual machine. Unassociated reserved ip migration is not supported at this time.                                                                                                                                                                                                                                                           |   |   |
| Public IP Address per VM                               | Public IP Address with dynamic Allocationmethod | Public IP address associated with the VM is converted as a public IP address resource with the allocation method set to static.                                                                                                                                                                                                                                                                                                                                   |   |   |
| Network Security Groups                                | Network Security Groups                         | NSGs associated with a subnet is cloned as part of the migration to the resource manager stack. Please note the NSG in the classic stack is not removed during the migration. However, the management plane operations for the NSG will be blocked when the migration is in progress.                                                                                                                                                                             |   |   |
| DNS Servers                                            | DNS Servers                                     | DNS Servers associated with a VNET or the VM gets migrated over as part of the corresponding resource migration along with all the properties.                                                                                                                                                                                                                                                                                                                    |   |   |
| User defined routes                                    | User defined routes                             | UDRs associated with a subnet is cloned as part of the migration to the resource manager stack. Please note the UDR in the classic stack is not removed during the migration. However, the management plane operations for the UDR will be blocked when the migration is in progress.                                                                                                                                                                             |   |   |
| IP forwarding property on a VM's network configuration | IP forwarding property on the NIC               | IP forwarding property on a VM is converted to a property on the network interface during the migration                                                                                                                                                                                                                                                                                                                                                           |   |   |
| Load balancer with multiple IPs                        | Load balancer with multiple Public IP Resources | Each and every public IP associated with the load balancer will be converted to a public IP resource and associated with the load balancer after migration.                                                                                                                                                                                                                                                                                                       |   |   |
| Internal DNS Names on the VM                           | Internal DNS Name on the NIC                    | During migration, the internal DNS Suffixes will be updated to match the suffixes of the resource manager stack. Please note that name resolution will continue to work after migration. However, the suffixes associated with the VMs will be changed.                                                                                                                                                                                                           |   |   |

## Sample illustration of a simple migration walkthrough

In the sample screenshots shown below, you can see the representation of a Cloud Service with a VM (Not in a VNET) after the Prepare phase.

![Screenshot that shows the Classic representation after prepare](./media/virtual-machines-windows-migration-asm-arm/asm-migration-prepare-portal.png)
![Screenshot that shows the Resource Manager representation after prepare](./media/virtual-machines-windows-migration-asm-arm/arm-migration-prepare-portal.png)

## Next steps

Now that you have an understanding of migration of Classic IaaS resources to Resource Manager, you can start migrating the resources.

- [Use PowerShell to migrate IaaS resources from Classic to Azure Resource Manager](virtual-machines-windows-ps-migration-asm-arm)
- [Use CLI to migrate IaaS resources from Classic to Azure Resource Manager](virtual-machines-windows-cli-migration-asm-arm)
- [Platform supported migration of IaaS resources from Classic to Azure Resource Manager stack](virtual-machines-windows-migration-asm-arm)
- [Clone a classic Virtual Machine to Azure Resource Manager using Community PowerShell Scripts](virtual-machines-windows-migration-scripts)
