<properties
linkid=dev-net-commons-tasks-staging-deployment
urlDisplayName=Staging Deployment
headerExpose=
pageTitle=Enable Staging Deployment - .NET - Develop
metaKeywords=Azure staging, Azure application staging, Azure test environment, Azure staging environment, Azure Virtual IP swap, Azure VIP swap, Azure .NET staging, Azure .NET test environment, Azure .NET staging environment, Azure .NET Virtual IP swap, Azure .NET VIP swap, Azure C# staging,  
footerExpose=
metaDescription=Deploy your Windows Azure application to a staging environment with an obfuscated URL, then use Virtual IP (VIP) swap to move to production.
umbracoNaviHide=0
disqusComments=1
/>
<h1>Staging an Application in Windows Azure</h1>
<p>A packaged application can be deployed to the staging environment in Windows Azure to be tested before you move it to the production environment in which the application is accessible on the Internet. The staging environment is exactly like the production environment, except that you can only access the staged application with an obfuscated URL that is generated by Windows Azure. After you have verified that your application is working correctly, it can be deployed to the production environment by performing a Virtual IP (VIP) swap.</p>
<p>This task includes the following steps:</p>
<ul>
<li><a href="#step1">Step 1: Stage an Application by Using the Management Portal</a></li>
<li><a href="#step2">Step 1 (Alternate): Stage an Application with Visual Studio</a></li>
<li><a href="#step3">Step 2: Deploy an Application to Production by Swapping VIPs</a></li>
</ul>
<a name="step1"></a>
<h2>Step 1: Stage an Application by Using the Management Portal</h2>
<p>This task covers how to stage an application by using the Windows Azure Management Portal. You can also <a href="#step2">Stage an Application with Visual Studio</a>.</p>
<ol>
<li>
<p>Log on to the <a href="http://windows.azure.com" target="_blank">Windows Azure Management Portal</a>.</p>
</li>
<li>
<p>In the Management Portal, click <strong>New Hosted Service</strong>.</p>
<p><img src="/media/net/common-task-staging-01.png"/></p>
</li>
<li>
<p>In the Create a New Hosted Service dialog, fill in the required information and select <strong>Deploy to stage environment</strong> under <strong>Deployment options</strong>.</p>
<p><img src="/media/net/common-task-staging-02.png"/></p>
</li>
<li>
<p>Click <strong>OK</strong> to create the hosted service.</p>
</li>
<li>
<p>After the hosted service is created and the deployment's status has been updated to <strong>Ready</strong>, click on the deployment and note the values in the <strong>Properties</strong> pane to the right. The DNS name is an obfuscated internal ID that Windows Azure generated. Also, the environment is set to <strong>Staging</strong>.</p>
<p><img src="/media/net/common-task-staging-03.png"/></p>
</li>
</ol>
<p>Now you can verify that the application is working correctly in the staging environment.</p>
<p>For an upgrade scenario, in which the staged application is an upgraded version of one that has already been deployed to production, you can <a href="#step3">upgrade the application in the production environment by swapping the VIPs</a>.</p>
<a name="step2"></a>
<h2>Step 1 (Alternate): Stage an Application with Visual Studio</h2>
<p>This task covers how to stage an application with Visual Studio. You can also <a href="#step1">Stage an Application with the Management Portal</a>.</p>
<p><strong>Note:</strong> This step requires Visual Studio 2010 and the Windows Azure SDK for .NET.</p>
<ol>
<li>
<p>Start Visual Studio 2010 and open a cloud project that's ready for deployment.</p>
</li>
<li>
<p>In the Solution Explorer, right-click the name of your project, and click <strong>Publish</strong>. The Publish Windows Azure Application wizard appears.</p>
</li>
<li>
<p>In the Windows Azure Publish Sign In page, select the named authentication credentials you want to use, and then click <strong>Next</strong>. For more information, see <a href="http://msdn.microsoft.com/en-us/library/windowsazure/ff683676.aspx">Setting Up Named Authentication Credentials.</a></p>
</li>
<li>
<p>In Windows Azure Publish Settings, select hosted service in which to publish the application, and then in Environment, select <strong>Staging</strong>.</p>
<p><img src="/media/net/common-task-staging-04.png"/></p>
</li>
<li>
<p>Use the defaults for the rest of the settings and click <strong>Next</strong>.</p>
</li>
<li>
<p>In Windows Azure Publish Summary, review the settings (make sure Environment is set to Staging), and then click <strong>Publish</strong>.</p>
</li>
</ol>
<p>Visual Studio starts the publishing process of packaging the application and then deploying it to Windows Azure. After several minutes, the deployment is completed.</p>
<p>Now you can verify that the application is working correctly in the staging environment.</p>
<p>For an upgrade scenario, in which the staged application is an upgraded version of one that has already been deployed to production, you can <a href="#step3">upgrade the application in the production environment by swapping the VIPs</a>.</p>
<a name="step3"></a>
<h2>Step 2: Upgrade an Application in Production by Swapping VIPs</h2>
<p>After you have verified the upgraded version of an application in the staging environment, you can quickly make it available in production by swapping the virtual IPs (VIPs) of the staging and production environments.</p>
<p><strong>Note:</strong> This step assumes that you have already deployed an application to production and staged the upgraded version of the application.</p>
<ol>
<li>
<p>Log into the <a href="http://windows.azure.com" target="_blank">Management Portal</a>, click <strong>Hosted Services, Storage Accounts, &amp; CDN</strong>, and click <strong>Hosted Services</strong>.</p>
</li>
<li>
<p>Expand the hosted service that contains the deployment that you want to upgrade, and then click <strong>Swap VIP</strong>. This opens the Swap VIPs dialog.</p>
<p><img src="/media/net/common-task-staging-05.png"/></p>
</li>
<li>
<p>Review the information, and then click <strong>OK</strong>. The two deployments begin updating as the staging deployment switches to production and the production deployment switches to staging.</p>
</li>
</ol>
<p>You have successfully staged a deployment and upgraded a production deployment by swapping VIPs with the deployment in staging.</p>
<h2>Additional Resources</h2>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsazure/ee517253.aspx">How to Deploy a Service Upgrade to Production by Swapping VIPs in Windows Azure</a></p>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsazure/hh386336.aspx">Overview of Managing Deployments in Windows Azure</a></p>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsazure/ee460772.aspx">Publishing Applications to Windows Azure from Visual Studio</a></p>